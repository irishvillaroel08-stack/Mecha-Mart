let data=[];const headers=['id','title','brand','category','price','compare_at_price','currency','thumbnail','images','stock','sku','tags','description'];async function load(){try{const r=await fetch('products.json');data=await r.json()}catch(e){data=[]}render()}function render(){const el=document.getElementById('table');const table=document.createElement('table');table.className='table';table.innerHTML='<thead><tr>'+headers.map(h=>`<th>${h}</th>`).join('')+'<th></th></tr></thead>';const tbody=document.createElement('tbody');data.forEach((row,idx)=>{const tr=document.createElement('tr');headers.forEach(h=>{const td=document.createElement('td');if(h==='images'||h==='tags'){const inp=document.createElement('input');inp.value=(row[h]||[]).join(', ');inp.oninput=e=>row[h]=e.target.value.split(',').map(s=>s.trim()).filter(Boolean);td.appendChild(inp)}else{const inp=document.createElement('input');inp.value=(row[h]??'');inp.oninput=e=>row[h]=(h==='price'||h==='compare_at_price'||h==='stock')?Number(e.target.value):e.target.value;td.appendChild(inp)}tr.appendChild(td)});const td=document.createElement('td');const del=document.createElement('button');del.className='btn danger';del.textContent='Delete';del.onclick=()=>{data.splice(idx,1);render()};td.appendChild(del);tr.appendChild(td);tbody.appendChild(tr)});table.appendChild(tbody);el.innerHTML='';el.appendChild(table)}document.getElementById('add').onclick=()=>{data.unshift({id:'new-'+Date.now(),title:'New Product',brand:'',category:'',price:0,compare_at_price:null,currency:'NZD',thumbnail:'assets/placeholder.svg',images:['assets/placeholder.svg'],stock:0,sku:'',tags:[],description:''});render()};document.getElementById('download').onclick=()=>{const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='products.json';a.click()};document.getElementById('file').onchange=e=>{const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=()=>{try{data=JSON.parse(reader.result);render()}catch(err){alert('Invalid JSON')}};reader.readAsText(file)};load();
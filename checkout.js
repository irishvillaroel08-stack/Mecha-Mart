function renderSummary(){const items=getCart();const list=document.getElementById('summary');list.innerHTML=items.map(i=>`<div style='display:flex;justify-content:space-between'><span>${i.title} Ã— ${i.qty}</span><span>${currency(i.price*i.qty)}</span></div>`).join('')||'<div>No items.</div>';const t=cartTotals();document.getElementById('sum-sub').textContent=currency(t.subtotal);document.getElementById('sum-ship').textContent=currency(t.shipping);document.getElementById('sum-total').textContent=currency(t.total);}async function handlePay(e){e.preventDefault();const items=getCart().map(i=>({title:i.title,price:i.price,qty:i.qty}));if(items.length===0){toast('Your cart is empty');return;}try{const res=await fetch('/.netlify/functions/create-checkout-session',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({items,successUrl:location.origin+'/success.html',cancelUrl:location.origin+'/cancel.html'})});if(!res.ok){const t=await res.text();throw new Error(t);}const {url}=await res.json();location.href=url;}catch(err){alert('Checkout error: '+err.message+'\n\nDid you set STRIPE_SECRET_KEY in Netlify?');}}document.addEventListener('DOMContentLoaded',()=>{renderSummary();document.getElementById('checkout-form').addEventListener('submit',handlePay);});